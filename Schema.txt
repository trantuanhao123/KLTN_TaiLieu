{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Car Rental - Collection Schemas (Draft-07)",
  "definitions": {
    "objectId": {
      "type": "string",
      "pattern": "^[a-fA-F0-9]{24}$"
    },
    "dateTime": {
      "type": "string",
      "format": "date-time"
    },
    "currency": {
      "type": "string",
      "minLength": 3,
      "maxLength": 5
    },
    "phone": {
      "type": "string",
      "minLength": 6,
      "maxLength": 20
    },
    "geoPoint": {
      "type": "object",
      "required": [
        "type",
        "coordinates"
      ],
      "properties": {
        "type": {
          "const": "Point"
        },
        "coordinates": {
          "type": "array",
          "minItems": 2,
          "maxItems": 2,
          "items": {
            "type": "number"
          }
        }
      },
      "additionalProperties": false
    },
    "imageItem": {
      "type": "object",
      "required": [
        "url"
      ],
      "properties": {
        "url": {
          "type": "string",
          "format": "uri"
        },
        "type": {
          "type": "string"
        },
        "caption": {
          "type": "string"
        },
        "width": {
          "type": "integer",
          "minimum": 0
        },
        "height": {
          "type": "integer",
          "minimum": 0
        }
      },
      "additionalProperties": false
    },
    "address": {
      "type": "object",
      "required": [
        "full_text"
      ],
      "properties": {
        "street": {
          "type": "string"
        },
        "ward": {
          "type": "string"
        },
        "district": {
          "type": "string"
        },
        "city": {
          "type": "string"
        },
        "country": {
          "type": "string",
          "default": "VN"
        },
        "full_text": {
          "type": "string"
        },
        "location": {
          "$ref": "#/definitions/geoPoint"
        }
      },
      "additionalProperties": false
    }
  },
  "schemas": {
    "vehicle_categories": {
      "title": "vehicle_categories",
      "type": "object",
      "additionalProperties": false,
      "required": [
        "_id",
        "code",
        "name"
      ],
      "properties": {
        "_id": {
          "$ref": "#/definitions/objectId"
        },
        "code": {
          "type": "string",
          "description": "business code, unique"
        },
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "default_features": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": []
        },
        "created_at": {
          "$ref": "#/definitions/dateTime"
        },
        "updated_at": {
          "$ref": "#/definitions/dateTime"
        }
      }
    },
    "branches": {
      "title": "branches",
      "type": "object",
      "additionalProperties": false,
      "required": [
        "_id",
        "name",
        "address",
        "phone"
      ],
      "properties": {
        "_id": {
          "$ref": "#/definitions/objectId"
        },
        "name": {
          "type": "string"
        },
        "code": {
          "type": "string"
        },
        "address": {
          "$ref": "#/definitions/address"
        },
        "phone": {
          "$ref": "#/definitions/phone"
        },
        "opening_hours": {
          "type": "object",
          "additionalProperties": {
            "type": "object",
            "properties": {
              "open": {
                "type": "string",
                "pattern": "^[0-2][0-9]:[0-5][0-9]$"
              },
              "close": {
                "type": "string",
                "pattern": "^[0-2][0-9]:[0-5][0-9]$"
              }
            },
            "required": [
              "open",
              "close"
            ],
            "additionalProperties": false
          }
        },
        "location": {
          "$ref": "#/definitions/geoPoint"
        },
        "notes": {
          "type": "string"
        },
        "created_at": {
          "$ref": "#/definitions/dateTime"
        },
        "updated_at": {
          "$ref": "#/definitions/dateTime"
        }
      }
    },
    "vehicles": {
      "title": "vehicles",
      "type": "object",
      "additionalProperties": false,
      "required": [
        "_id",
        "vehicle_id",
        "category_id",
        "brand",
        "plate_number",
        "rental_rate",
        "status",
        "location_branch_id"
      ],
      "properties": {
        "_id": {
          "$ref": "#/definitions/objectId"
        },
        "vehicle_id": {
          "type": "string"
        },
        "category_id": {
          "$ref": "#/definitions/objectId"
        },
        "brand": {
          "type": "string"
        },
        "model": {
          "type": "string"
        },
        "year": {
          "type": "integer",
          "minimum": 1900,
          "maximum": 2100
        },
        "plate_number": {
          "type": "string"
        },
        "color": {
          "type": "string"
        },
        "transmission": {
          "type": "string",
          "enum": [
            "auto",
            "manual",
            "cvt",
            "other"
          ]
        },
        "fuel_type": {
          "type": "string"
        },
        "seats": {
          "type": "integer",
          "minimum": 1
        },
        "mileage_km": {
          "type": "integer",
          "minimum": 0
        },
        "status": {
          "type": "string",
          "enum": [
            "available",
            "reserved",
            "rented",
            "maintenance",
            "inactive"
          ]
        },
        "location_branch_id": {
          "$ref": "#/definitions/objectId"
        },
        "rental_rate": {
          "type": "object",
          "required": [
            "per_day",
            "currency"
          ],
          "additionalProperties": false,
          "properties": {
            "per_day": {
              "type": "integer",
              "minimum": 0
            },
            "per_hour": {
              "type": "integer",
              "minimum": 0
            },
            "currency": {
              "$ref": "#/definitions/currency"
            },
            "min_rental_hours": {
              "type": "integer",
              "minimum": 0
            }
          }
        },
        "features": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "images": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/imageItem"
          }
        },
        "description": {
          "type": "string"
        },
        "vin": {
          "type": "string"
        },
        "insurance": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "provider": {
              "type": "string"
            },
            "policy_no": {
              "type": "string"
            },
            "valid_until": {
              "$ref": "#/definitions/dateTime"
            }
          }
        },
        "created_at": {
          "$ref": "#/definitions/dateTime"
        },
        "updated_at": {
          "$ref": "#/definitions/dateTime"
        }
      }
    },
    "users": {
      "title": "users",
      "type": "object",
      "additionalProperties": false,
      "required": [
        "_id",
        "user_id",
        "name",
        "phone",
        "roles"
      ],
      "properties": {
        "_id": {
          "$ref": "#/definitions/objectId"
        },
        "user_id": {
          "type": "string"
        },
        "name": {
          "type": "string"
        },
        "email": {
          "type": [
            "string",
            "null"
          ],
          "format": "email"
        },
        "phone": {
          "$ref": "#/definitions/phone"
        },
        "password_hash": {
          "type": "string"
        },
        "roles": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "profile": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "dob": {
              "type": "string",
              "format": "date"
            },
            "gender": {
              "type": "string",
              "enum": [
                "male",
                "female",
                "other",
                "unknown"
              ]
            },
            "id_type": {
              "type": "string",
              "enum": [
                "CCCD",
                "CMND",
                "Passport",
                "DriverLicense",
                "Other"
              ]
            },
            "id_number_encrypted": {
              "type": "string"
            },
            "id_issue_date": {
              "$ref": "#/definitions/dateTime"
            },
            "id_issue_place": {
              "type": "string"
            }
          }
        },
        "default_address": {
          "$ref": "#/definitions/address"
        },
        "status": {
          "type": "string",
          "enum": [
            "active",
            "suspended",
            "deleted"
          ]
        },
        "metadata": {
          "type": "object"
        },
        "created_at": {
          "$ref": "#/definitions/dateTime"
        },
        "updated_at": {
          "$ref": "#/definitions/dateTime"
        }
      }
    },
    "addresses": {
      "title": "addresses",
      "type": "object",
      "additionalProperties": false,
      "required": [
        "_id",
        "full_text"
      ],
      "properties": {
        "_id": {
          "$ref": "#/definitions/objectId"
        },
        "user_id": {
          "$ref": "#/definitions/objectId"
        },
        "label": {
          "type": "string"
        },
        "address": {
          "$ref": "#/definitions/address"
        },
        "is_default": {
          "type": "boolean",
          "default": false
        },
        "created_at": {
          "$ref": "#/definitions/dateTime"
        },
        "updated_at": {
          "$ref": "#/definitions/dateTime"
        }
      }
    },
    "rentals": {
      "title": "rentals",
      "type": "object",
      "additionalProperties": false,
      "required": [
        "_id",
        "rental_no",
        "user_id",
        "vehicle_id",
        "status",
        "rental_period",
        "pricing"
      ],
      "properties": {
        "_id": {
          "$ref": "#/definitions/objectId"
        },
        "rental_no": {
          "type": "string"
        },
        "user_id": {
          "$ref": "#/definitions/objectId"
        },
        "vehicle_id": {
          "$ref": "#/definitions/objectId"
        },
        "status": {
          "type": "string",
          "enum": [
            "requested",
            "confirmed",
            "ongoing",
            "completed",
            "cancelled",
            "no_show"
          ]
        },
        "pickup": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "branch_id",
            "address",
            "scheduled_at"
          ],
          "properties": {
            "branch_id": {
              "$ref": "#/definitions/objectId"
            },
            "address": {
              "type": "string"
            },
            "scheduled_at": {
              "$ref": "#/definitions/dateTime"
            }
          }
        },
        "dropoff": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "branch_id",
            "address",
            "scheduled_at"
          ],
          "properties": {
            "branch_id": {
              "$ref": "#/definitions/objectId"
            },
            "address": {
              "type": "string"
            },
            "scheduled_at": {
              "$ref": "#/definitions/dateTime"
            }
          }
        },
        "rental_period": {
          "type": "object",
          "required": [
            "start",
            "end"
          ],
          "additionalProperties": false,
          "properties": {
            "start": {
              "$ref": "#/definitions/dateTime"
            },
            "end": {
              "$ref": "#/definitions/dateTime"
            },
            "hours": {
              "type": "number",
              "minimum": 0
            },
            "days": {
              "type": "integer",
              "minimum": 0
            }
          }
        },
        "pricing": {
          "type": "object",
          "required": [
            "base",
            "total",
            "currency"
          ],
          "additionalProperties": false,
          "properties": {
            "base": {
              "type": "integer",
              "minimum": 0
            },
            "addons": {
              "type": "array",
              "items": {
                "type": "object",
                "additionalProperties": false,
                "required": [
                  "code",
                  "name",
                  "price"
                ],
                "properties": {
                  "code": {
                    "type": "string"
                  },
                  "name": {
                    "type": "string"
                  },
                  "price": {
                    "type": "integer",
                    "minimum": 0
                  }
                }
              }
            },
            "discount": {
              "type": "integer",
              "minimum": 0
            },
            "tax": {
              "type": "integer",
              "minimum": 0
            },
            "deposit": {
              "type": "integer",
              "minimum": 0
            },
            "total": {
              "type": "integer",
              "minimum": 0
            },
            "currency": {
              "$ref": "#/definitions/currency"
            }
          }
        },
        "payment_status": {
          "type": "string",
          "enum": [
            "pending",
            "paid",
            "refunded",
            "partial"
          ]
        },
        "payment_ids": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/objectId"
          }
        },
        "promo_code": {
          "type": [
            "string",
            "null"
          ]
        },
        "notes": {
          "type": "string"
        },
        "created_at": {
          "$ref": "#/definitions/dateTime"
        },
        "updated_at": {
          "$ref": "#/definitions/dateTime"
        }
      }
    },
    "payments": {
      "title": "payments",
      "type": "object",
      "additionalProperties": false,
      "required": [
        "_id",
        "payment_no",
        "rental_id",
        "user_id",
        "amount",
        "currency",
        "method",
        "status"
      ],
      "properties": {
        "_id": {
          "$ref": "#/definitions/objectId"
        },
        "payment_no": {
          "type": "string"
        },
        "rental_id": {
          "$ref": "#/definitions/objectId"
        },
        "user_id": {
          "$ref": "#/definitions/objectId"
        },
        "amount": {
          "type": "integer",
          "minimum": 0
        },
        "currency": {
          "$ref": "#/definitions/currency"
        },
        "method": {
          "type": "string",
          "enum": [
            "momo",
            "zalopay",
            "card",
            "bank_transfer",
            "cash",
            "stripe",
            "paypal",
            "other"
          ]
        },
        "status": {
          "type": "string",
          "enum": [
            "pending",
            "paid",
            "failed",
            "refunded"
          ]
        },
        "transaction_ref": {
          "type": [
            "string",
            "null"
          ]
        },
        "paid_at": {
          "$ref": "#/definitions/dateTime"
        },
        "refund": {
          "type": [
            "object",
            "null"
          ],
          "additionalProperties": false,
          "properties": {
            "status": {
              "type": "string",
              "enum": [
                "none",
                "processing",
                "done",
                "failed"
              ]
            },
            "amount": {
              "type": "integer",
              "minimum": 0
            },
            "ref_at": {
              "$ref": "#/definitions/dateTime"
            }
          }
        },
        "receipt_url": {
          "type": "string",
          "format": "uri"
        },
        "created_at": {
          "$ref": "#/definitions/dateTime"
        }
      }
    },
    "promotions": {
      "title": "promotions",
      "type": "object",
      "additionalProperties": false,
      "required": [
        "_id",
        "code",
        "type",
        "value",
        "valid_from",
        "valid_to"
      ],
      "properties": {
        "_id": {
          "$ref": "#/definitions/objectId"
        },
        "code": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "type": {
          "type": "string",
          "enum": [
            "fixed",
            "percent"
          ]
        },
        "value": {
          "type": "number",
          "minimum": 0
        },
        "currency": {
          "$ref": "#/definitions/currency"
        },
        "min_spend": {
          "type": "integer",
          "minimum": 0
        },
        "valid_from": {
          "$ref": "#/definitions/dateTime"
        },
        "valid_to": {
          "$ref": "#/definitions/dateTime"
        },
        "usage_limit": {
          "type": "integer",
          "minimum": 0
        },
        "per_user_limit": {
          "type": "integer",
          "minimum": 0
        },
        "applicable_category_ids": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/objectId"
          }
        },
        "created_at": {
          "$ref": "#/definitions/dateTime"
        },
        "updated_at": {
          "$ref": "#/definitions/dateTime"
        }
      }
    },
    "reviews": {
      "title": "reviews",
      "type": "object",
      "additionalProperties": false,
      "required": [
        "_id",
        "user_id",
        "vehicle_id",
        "rating",
        "created_at"
      ],
      "properties": {
        "_id": {
          "$ref": "#/definitions/objectId"
        },
        "user_id": {
          "$ref": "#/definitions/objectId"
        },
        "rental_id": {
          "$ref": "#/definitions/objectId"
        },
        "vehicle_id": {
          "$ref": "#/definitions/objectId"
        },
        "rating": {
          "type": "integer",
          "minimum": 1,
          "maximum": 5
        },
        "title": {
          "type": "string"
        },
        "comment": {
          "type": "string"
        },
        "images": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uri"
          }
        },
        "created_at": {
          "$ref": "#/definitions/dateTime"
        }
      }
    },
    "maintenance": {
      "title": "maintenance",
      "type": "object",
      "additionalProperties": false,
      "required": [
        "_id",
        "vehicle_id",
        "type",
        "start_date",
        "status"
      ],
      "properties": {
        "_id": {
          "$ref": "#/definitions/objectId"
        },
        "vehicle_id": {
          "$ref": "#/definitions/objectId"
        },
        "type": {
          "type": "string",
          "enum": [
            "scheduled",
            "repair",
            "accident",
            "inspection"
          ]
        },
        "description": {
          "type": "string"
        },
        "start_date": {
          "$ref": "#/definitions/dateTime"
        },
        "end_date": {
          "$ref": [
            "#/definitions/dateTime",
            "null"
          ]
        },
        "status": {
          "type": "string",
          "enum": [
            "planned",
            "in_progress",
            "done",
            "cancelled"
          ]
        },
        "cost": {
          "type": "integer",
          "minimum": 0
        },
        "attachments": {
          "type": "array",
          "items": {
            "type": "string",
            "format": "uri"
          }
        },
        "created_at": {
          "$ref": "#/definitions/dateTime"
        }
      }
    },
    "roles": {
      "title": "roles",
      "type": "object",
      "additionalProperties": false,
      "required": [
        "_id",
        "name"
      ],
      "properties": {
        "_id": {
          "$ref": "#/definitions/objectId"
        },
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "permissions": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "created_at": {
          "$ref": "#/definitions/dateTime"
        },
        "updated_at": {
          "$ref": "#/definitions/dateTime"
        }
      }
    },
    "audit_logs": {
      "title": "audit_logs",
      "type": "object",
      "additionalProperties": false,
      "required": [
        "_id",
        "entity",
        "entity_id",
        "action",
        "performed_by",
        "performed_at"
      ],
      "properties": {
        "_id": {
          "$ref": "#/definitions/objectId"
        },
        "entity": {
          "type": "string"
        },
        "entity_id": {
          "$ref": "#/definitions/objectId"
        },
        "action": {
          "type": "string"
        },
        "before": {
          "type": [
            "object",
            "null"
          ]
        },
        "after": {
          "type": [
            "object",
            "null"
          ]
        },
        "performed_by": {
          "$ref": "#/definitions/objectId"
        },
        "performed_at": {
          "$ref": "#/definitions/dateTime"
        },
        "meta": {
          "type": "object"
        }
      }
    },
    "media": {
      "title": "media",
      "type": "object",
      "additionalProperties": false,
      "required": [
        "_id",
        "url",
        "owner_type",
        "owner_id"
      ],
      "properties": {
        "_id": {
          "$ref": "#/definitions/objectId"
        },
        "url": {
          "type": "string",
          "format": "uri"
        },
        "mime_type": {
          "type": "string"
        },
        "size": {
          "type": "integer",
          "minimum": 0
        },
        "owner_type": {
          "type": "string"
        },
        "owner_id": {
          "type": "string"
        },
        "tags": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "created_at": {
          "$ref": "#/definitions/dateTime"
        }
      }
    },
    "vehicle_reservations": {
      "title": "vehicle_reservations",
      "type": "object",
      "additionalProperties": false,
      "required": [
        "_id",
        "vehicle_id",
        "start",
        "end",
        "status"
      ],
      "properties": {
        "_id": {
          "$ref": "#/definitions/objectId"
        },
        "vehicle_id": {
          "$ref": "#/definitions/objectId"
        },
        "rental_id": {
          "$ref": [
            "#/definitions/objectId",
            "null"
          ]
        },
        "start": {
          "$ref": "#/definitions/dateTime"
        },
        "end": {
          "$ref": "#/definitions/dateTime"
        },
        "status": {
          "type": "string",
          "enum": [
            "reserved",
            "blocked",
            "confirmed",
            "cancelled"
          ]
        },
        "created_at": {
          "$ref": "#/definitions/dateTime"
        }
      }
    }
  }
}